{% extends 'waiting_customer_shipment_report/reports/base.html' %}

{% block main %}
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-6">
      <div>
          {% block header_logo %}{% endblock %}
      </div>
    </div>
    <div class="col-xs-6">
      <div class="row" style="padding-bottom:20px;">
        <div class="col-xs-12">
          <span class="h3">Items Waiting Shipment</span>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-2">
          <strong>Date:</strong>
        </div>
        <div class="col-xs-8 text-capitalize">
          {{ datetime.date.today()|dateformat }}
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <hr />
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      {% for product, shipments in shipments_by_products.iteritems() %}
        <table class="table">
          <tbody>
            <tr class="success product-bar">
              <td>
                <b>Product:</b> {{ product.name }}
              </td>
              <td>
                <b>SKU:</b> {{ product.code or '-' }}
              </td>
              <td>
                <b>Oldest Date</b> {{ shipments|oldest_date }}
              </td>
            </tr>
            <tr class="shipments-row">
              <td colspan="3">
                <div class="row">
                  <div class="col-xs-10 col-xs-offset-1">
                    <table class="table table-condensed">
                      <thead>
                        <th>Shipment</th>
                        <th>Customer</th>
                        <th>Planned Date</th>
                        <th class="text-right">Quantity</th>
                        <th class="text-right">State</th>
                      </thead>
                      <tbody>
                        {% for shipment in shipments|sort(attribute='planned_date') %}
                          <tr>
                            {% set quantity, uom, unit_digits = product|product_quantity(shipment) %}
                            <td>{{ shipment.code or '-' }}</td>
                            <td>{{ shipment.customer.name }}</td>
                            <td>{{ shipment.planned_date }}</td>
                            <td class="text-right">{{ formatLang(quantity, shipment.customer.lang, unit_digits) }}</td>
                            <td class="text-capitalize text-right">{{ shipment.state }}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script type="text/javascript">
    $(document).ready(function(){
      var report_ext = "{{ report_ext }}";
      if (report_ext == "html") {
        $(".shipments-row").hide();
      }
    });
    $(".product-bar").click(function() {
      $(this).siblings(".shipments-row").toggle();
    });
  </script>
{% endblock %}
